# Shell脚本

> 系统化训练 - 实现方式多种多样，考虑：可靠性、容错性、性能、可扩展性...
>
> - 内核：系统内存、软件程序、硬件设备、文件系统
> - GNU工具链： 处理文件，操作文本，管理进程
> - 应用软件：包括terminal | 窗口管理软件

## 存储管理

### 磁盘管理

> 无法清晰评估：磁盘占用大小 【win | ubuntu】

- df -> du
- 





### 文件系统

> FS实现：文件目录、文件的管理，文件权限 <- **虚拟目录结构**
>
> 安全系统：用户账户

- ext文件系统： 文件名，大小，属性，属组，访问权限
  - 索引节点系统，索引节点表 - 索引节点号 [磁盘块指针]-> 磁盘碎片化 
  - 索引节点表格式的扩展： ext2
    - 扩展ext单文件大小2G, 增加：创建时间，修改时间，最后访问时间：追踪文件的访问情况
    - 改变文件在数据块中存储方式：按组分配
  - 缺陷：写磁盘 & 更新索引节点表非同步！
- 日志文件系统
  - 实现方法： 数据模式-最安全， 有序模式， 回写模式
  - ext3: 
    - 有序模式-索引节点写入日志，只有数据写磁盘成功后，才删除日志。 【性能|安全折中】
    - 缺陷：无法恢复误删除的文件 ， 无：内建的数据压缩功能 ， 不支持加密文件
  - ext4: 支持数据压缩，加密
    - 区段特性：减小索引节点表内容
    - 快预分配技术
  - Resier | JFS | XFS
- 写时复制文件系统 - COW
  - ZFS
  - Btrf文件系统： B树

#### 分区驱动程序

> IDE 、SATA 、SCSI驱动器

- 扩展分区：逻辑卷管理器 - LVM 【缺少实践：对DB,等不同web服务器配置不同的fs】
- LVM2: 
  - 支持逻辑卷在线的 可读写快照 <- 如何实现？
  - 跨多硬盘实现：逻辑卷 ， 
  - 镜像



### 包管理系统

> PMS : 数据库如何维护软件安装信息，具体：软件包，包内文件，文件的版本号维护

- dpdk | rpm -> 前端工具： apt  | yum, urpm, zypper

- 案例研究：

  ```c
  // sysstat
  
  
  ```

- 



### 编辑器





#### 安全系统

- 用户
  - /etc/password , /etc/shadow : 存放用户密码信息
  - /etc/skel 目录： 新增用户信息模板
- 组 - sudo,获取root临时权限
- 文件权限： 用户，用户组，其他 ： rwx
- 

```c
// useradd脚本熟悉


```





### 信息检索

> grep | egrep | fgrep -> 正则表达式



### 文件压缩

> gz | Z | bz2 | zip || tar
>
> 压缩算法性能







## 安全

> 访问控制
>
> 加密算法







## 进程管理

### 信号量

> HUP | INT | QUIT | KILL | SEGV | TERM | STOP | TSTP | CONT





## 设备管理

> mount | umount : 设备挂载







## 脚本

> 基础： 结构化指令 、 函数 || docker/docker compose...借鉴

- 注意：子shell创建情况： 非shell内建命令
- 功能：
  - 环境变量 | 变量 | 输入输出重定向 | 管道-连接命令重定向 | 
    - 内联重定向： EOF ... EOF
    - pipe如何实现？
  - 基本类型：**整型运算|比较** ， zshell支持**浮点数**
  - 结构化命令： 改变执行顺序 : 基于 指令的**退出码**
    - 高级特性： （（）） 与 【【】】
    - 复合指令： && 与 ；  || 或
    - if-then（-else） + 嵌套 || case when
      - if -then-elif-then-fi
      - test  || {}
      - **case var in  ) ;; *) ;;**
      - 支持：整型，字符串, 文件
        - 整型：-eq -ne -gt -ge -lt -le
        - 字符串注意： > < * 等的转义字符
        - 文件比较： 

| syntax         | feature                                | remark |
| -------------- | -------------------------------------- | ------ |
| -d             | 是否是目录                             |        |
| -e             | 是否存在                               |        |
| -f             | 是否是文件                             |        |
| -r\|-w\|-s\|-x | 是否只读\|只写\|不为空\|可执行         |        |
| -O\|-G         | 是否文件属主 \| 文件属主与组名是否一致 |        |
| -nt\|-ot       | A 文件创建日期是 新还是旧于 B          |        |



```markdown
# qa - 内核实现原理与源码细节
- 系统调用的熟悉：
- 内核swapping out 
- 5个启动运行级 || 桌面的lancher - 启动器/win快捷键
- 插入内核设备驱动如何实现
- 回环设备 - 基于文件系统：节点的特殊文件
- 对文件系统的兼容，如何与不同类型文件通信
- shell : 命令行提示符 ； shell脚本是阻塞执行-开启新进程执行【除非进程意外终止】
- 显卡，显示器如何实现 || 网卡
- GNU
- FS : 隐藏文件， 如何管理文件： ls , 文件创建、修改时间
	- 查看文件：cat | more实现区别
- 所有shell指令实现源码
	- 解读：原理与实现
		- shell类型，功能特性 
		- 父子关系 ： 进程列表，协程，管道 || 【基础】
			- 协程：只是子shell执行脚本？性能有何优势？ || 区别：go routine
			- 
    - 全局|局部环境变量：生效的地方，节点
    	- 根据启动方式不同：
    		- 登录shell -> bash shell主启动文件：/etc/profile ,{默认加载一个：/$HOME/.bash_profile, .bash_login ,/$HOME/.profile}
    		- /etc/environment : 
    		- 交互shell ->/$HOME/.bashrc { || 用户自定义：命令别名、私有脚本函数}
    		- 非交互式shell -> 执行脚本：主要是继承：父shell BASH_ENV
	- 信号量： 停止运行 与终止的区别
	- 
```

- 高级特性

  - for | while | until || 嵌套循环

    - IFS : 空格，制表符，换行符
    - break | continue 支持多层级跳出循环

  - 用户输入 | 输出

    - 获取命令行参数： ${num} / $!最后一个参数 、 $* | $@区别

    - getopt optstring params... -> 缺陷：不擅长处理 带空格 与 双引号的参数值

    - getopts

      ![image-20231022063523516](C:\Users\86156\AppData\Roaming\Typora\typora-user-images\image-20231022063523516.png)

  - read

    - 特性： 超时 、 隐藏输入，读取文件-管道方式

  - 一个进程：9个文件描述符

    - 运行模式： 实时模式， 
    - 控制信号：SIGHUP, SIGINT, SIGQUIT,SIGKILL,SIGTERM,SIGSTOP,SIGTSTP,SIGCONT
    - 定时任务：26中作业队列实现方式？
      - 【服务器】cron : /etc/coron.*ly : 支持 小时、日、周、月
      - anacron: 常规日志维护脚本

- 高级特性

  - 函数
  - 

- 案例

  - 清除日志文件： 不需要重新创建文件，清空内容：cat /dev/null > log
  - 从用户信息csv文件，输出拼接插入sql语句文件
  - 



## QA

- win cmd : ssh登录，会丢失连接信息
  - win cmd : mov  
- 共享文件：共用同一个属组的权限
  - SUID | SGID
- exec 0< file
  - ssh输出信息后，会自动断开连接，但是手动输入：file信息并不会断开连接
- 





## 案例研究

> sysstat | vim | git | 



### VIM

> 内存缓冲区 : 对比 emacs \ kde \ gnome